---
layout:     post
title:      "OS Travel"
subtitle:   "Prework"
date:       2019-12-24
author:     "Dylan"
header-img: "img/post-assassin_odyssey.jpg"
catalog: true
tags:
    - OS
    - Study diary
---


## Ubuntu环境变量配置

见[链接](https://blog.csdn.net/netwalk/article/details/9455893)


## LEBench配置

> [LEBench链接](https://github.com/LinuxPerfStudy/LEBench) : https://github.com/LinuxPerfStudy/LEBench

> [ExperimentSetup链接](https://github.com/LinuxPerfStudy/ExperimentSetup) : https://github.com/LinuxPerfStudy/ExperimentSetup

1、配环境(maybe unnecessary)

`sudo apt update`

`sudo apt install gcc`

`sudo apt install make`

2、加环境变量

eg: /etc/profile中加入 `export LEBENCH_DIR=/home/usrname/LEBench/`

`sudu reboot`

3、LEBench目录下，`python get_kern.py`

4、需运行2次。LEBench目录下，`sudo -E python run.py >> ./LEBench.out 2>&1`


## GitKernelBuild

>([Reference](https://wiki.ubuntu.com/KernelTeam/GitKernelBuild)) 


#### Init

You will need to install the following packages:

sudo　apt-get　install　git　build-essential　kernel-package　fakeroot　libncurses5-dev　libelf-dev　　libssl-dev　ccache　bison　flex

```
PASSWORD=

echo $PASSWORD  | sudo -S apt-get update
echo $PASSWORD  | sudo -S apt-get install git -y
echo $PASSWORD  | sudo -S apt-get install build-essential -y
echo $PASSWORD  | sudo -S apt-get install kernel-package -y
echo $PASSWORD  | sudo -S apt-get install fakeroot -y
echo $PASSWORD  | sudo -S apt-get install libncurses5-dev -y
echo $PASSWORD  | sudo -S apt-get install libelf-dev -y
echo $PASSWORD  | sudo -S apt-get install libssl-dev -y
echo $PASSWORD  | sudo -S apt-get install ccache -y
echo $PASSWORD  | sudo -S apt-get install bison -y
echo $PASSWORD  | sudo -S apt-get install flex -y
```

#### Custom Building a Kernel

1、Download the kernel codebase: `git clone git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git`

2、checkout the version of choice, for example: `git checkout v4.0.1`.

3、``cp /boot/config-`uname -r` .config``

4、Bring the config file up to date: `make oldconfig` or `yes '' | make oldconfig`

5、(optional) make any kernel config changes: `make menuconfig`

6、如果不是第一次更换内核，`make clean`

7、To apply a patch, run: `git apply <name>.patch`

8、build the linux-image and linux-header: ``make -j`getconf _NPROCESSORS_ONLN` deb-pkg LOCALVERSION=-custom`` custom可以换成任意英文或者数字 (Newer kernels can be compiled on Ubuntu 16 without a problem; some older kernels need to be compiled using Ubuntu 14 for libc compatibility)

9、Change to one directory level up: cd ..

10、install the custom kernel, run: `sudo dpkg -i *.deb` (linux-image & linux-headers)

11、`sudo reboot`

---

use shell, after checkout run this:

```
cp /boot/config-`uname -r` .config
yes '' | make oldconfig
make clean
make -j`getconf _NPROCESSORS_ONLN` deb-pkg LOCALVERSION=-custom
```

then goto step 9